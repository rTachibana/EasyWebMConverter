# Easy WebM Comverter - 動画エンコーダー

Windows、Linux、macOS環境で、動画ファイルをWebMまたはMP4形式に簡単に変換するためのポータブルツールです。ポータブル版Pythonを内蔵しているため、Pythonがインストールされていない環境でも使用可能です。

## 機能

- 動画ファイルからMP4（H.264）またはWebM（VP9）へのエンコード
- リアルタイムの進捗表示（パーセンテージ表示）
- シンプルなコマンドラインインターフェース
- プリセット化されたサイズとビットレートの選択
- タイムスタンプ付きの出力ファイル名（年月日-時分秒）
- ポータブル版Python内蔵（Pythonのインストール不要）
- 複数動画の連続処理機能（エンコード終了後に別の動画を続けて処理可能）
- 日本語などのマルチバイト文字を含むファイルパスのサポート
- ユーザー設定ファイルによるカスタマイズ機能
- クロスプラットフォーム対応（Windows, Linux, macOS）
- 自動セットアップ機能（必要なコンポーネントを自動検出・インストール）
- オリジナルのアスペクト比を維持するリサイズ機能
- 自動ビットレート調整機能（コンテンツに最適な品質を保持）

## 機能の詳細

### サイズ設定とアスペクト比

Easy WebM Comverterは元の動画のアスペクト比を維持したままリサイズすることができます。サイズオプションは以下の通りです：

- **Original**: 元のサイズをそのまま維持します
- **HD (1280p max)**: 長辺が1280ピクセルになるようにリサイズし、アスペクト比を保持します
- **SD (720p max)**: 長辺が720ピクセルになるようにリサイズし、アスペクト比を保持します
- **Small (480p max)**: 長辺が480ピクセルになるようにリサイズし、アスペクト比を保持します
- **Tiny (360p max)**: 長辺が360ピクセルになるようにリサイズし、アスペクト比を保持します

例えば、1920x1080（16:9）の動画を「HD」に設定すると、1280x720にリサイズされます。一方、1080x1920（縦長の9:16）の動画を「HD」に設定すると、720x1280にリサイズされます。正方形の動画も同様に、アスペクト比が維持されます。

### ビットレート設定

以下のビットレートオプションを選択できます：

- **Auto (Quality-based)**: 動画の内容に応じて最適なビットレートを自動的に決定します
  - MP4の場合はCRF 23（H.264の標準品質）
  - WebMの場合はCRF 30（VP9の標準品質）
  - 複雑なシーンや動きの多いシーンは高ビットレートに、単純なシーンは低ビットレートに自動調整
- **High Quality (2Mbps)**: 高品質な映像を維持します（大きめのファイルサイズ）
- **Standard (1Mbps)**: 標準的な品質とファイルサイズのバランス
- **Low Quality (500kbps)**: 小さいファイルサイズに最適化（品質は低下）

自動モードはファイルサイズの予測が難しいですが、内容に応じて最適な品質を維持できるためおすすめです。特定のビットレートが必要な場合は、他のオプションを選択してください。

## セットアップ

### Windows

1. このリポジトリをダウンロードまたはクローンします
2. **Windowsエクスプローラーから** `setup.bat` をダブルクリックして実行します
   - PowerShellスクリプトが自動的に実行されます
   - ポータブル版Pythonが自動的にダウンロードされます
   - FFmpegが自動的にダウンロードされます

セットアップには数分かかることがあります。インターネット接続が必要です。

> **重要**: バッチファイルはWindowsコマンドプロンプトまたはエクスプローラーから実行してください。Git Bash、Cygwin、WSLなどの別のシェルからは実行しないでください。

### Linux / macOS

1. このリポジトリをダウンロードまたはクローンします
2. ターミナルを開き、リポジトリのディレクトリに移動します
3. 以下のコマンドを実行して、セットアップスクリプトを実行可能にします：
   ```bash
   chmod +x setup.sh
   ```
4. セットアップスクリプトを実行します：
   ```bash
   ./setup.sh
   ```

セットアップスクリプトは自動的に以下を行います：
- プラットフォームとアーキテクチャを検出（x86_64/arm64、Linux/macOS）
- 適切なポータブル版Pythonをダウンロード
- プラットフォームに適したFFmpegバイナリをダウンロード
- 必要なディレクトリ構成を作成

セットアップには数分かかることがあります。インターネット接続が必要です。`curl`または`wget`が必要です。

## 使い方（簡単3ステップ）

### Windows

1. このリポジトリをダウンロードまたはクローンします
2. `2webm.bat`をダブルクリックするだけ！
   - 必要なコンポーネント（Python、FFmpeg）がない場合は自動的にインストールされます
3. 画面の指示に従って動画ファイルを変換

### Linux / macOS

1. このリポジトリをダウンロードまたはクローンします
2. ターミナルでリポジトリのディレクトリに移動し、`./2webm.sh`を実行するだけ！
   - 実行権限がない場合は自動的に付与されます
   - 必要なコンポーネント（Python、FFmpeg）がない場合は自動的にインストールされます
3. 画面の指示に従って動画ファイルを変換

## 詳細なセットアップ（手動）

通常は自動セットアップで十分ですが、手動でセットアップする場合は以下の手順に従ってください。

### Windows

1. このリポジトリをダウンロードまたはクローンします
2. **Windowsエクスプローラーから** `setup.bat` をダブルクリックして実行します
   - PowerShellスクリプトが自動的に実行されます
   - ポータブル版Pythonが自動的にダウンロードされます
   - FFmpegが自動的にダウンロードされます

セットアップには数分かかることがあります。インターネット接続が必要です。

> **重要**: バッチファイルはWindowsコマンドプロンプトまたはエクスプローラーから実行してください。Git Bash、Cygwin、WSLなどの別のシェルからは実行しないでください。

### Linux / macOS

1. このリポジトリをダウンロードまたはクローンします
2. ターミナルを開き、リポジトリのディレクトリに移動します
3. 以下のコマンドを実行して、セットアップスクリプトを実行可能にします：
   ```bash
   chmod +x setup.sh
   ```
4. セットアップスクリプトを実行します：
   ```bash
   ./setup.sh
   ```

セットアップスクリプトは自動的に以下を行います：
- プラットフォームとアーキテクチャを検出（x86_64/arm64、Linux/macOS）
- 適切なポータブル版Pythonをダウンロード
- プラットフォームに適したFFmpegバイナリをダウンロード
- 必要なディレクトリ構成を作成

セットアップには数分かかることがあります。インターネット接続が必要です。`curl`または`wget`が必要です。

## 詳細な使用方法

### Windows

1. セットアップが完了したら、**Windowsエクスプローラーから** `2webm.bat` をダブルクリックして実行します
   - 必要なコンポーネントがない場合は自動的にセットアップが実行されます
2. コマンドプロンプトが開き、メニューが表示されます
3. 画面の指示に従って入力ファイルのパスを入力し、出力形式、サイズ、ビットレートを選択します
4. エンコードの進捗状況がリアルタイムで表示されます
5. エンコードが完了すると、`output` ディレクトリに変換されたファイルが保存されます
6. 他の動画ファイルも処理したい場合は、「Do you want to process another video?」という質問に「y」と答えると、次の動画処理に進みます

### Linux / macOS

1. セットアップが完了したら、ターミナルでリポジトリのディレクトリに移動し、以下のコマンドを実行します：
   ```bash
   ./2webm.sh
   ```
   - 必要なコンポーネントがない場合は自動的にセットアップが実行されます
2. メニューが表示されるので、画面の指示に従って入力ファイルのパスを入力し、出力形式、サイズ、ビットレートを選択します
3. エンコードの進捗状況がリアルタイムで表示されます
4. エンコードが完了すると、`output` ディレクトリに変換されたファイルが保存されます

## 出力ファイル

エンコードされたファイルは以下の形式で保存されます:
```
output/output-yymmdd-HHMMSS.mp4   （MP4形式を選択した場合）
output/output-yymmdd-HHMMSS.webm  （WebM形式を選択した場合）
```

複数の動画を連続処理する場合、それぞれの出力ファイル名にはタイムスタンプが付くため、上書きされることはありません。

## システム要件

- Windows 10/11、または Linux、macOS
- インターネット接続（初回セットアップ時のみ）
- Linux/macOSの場合：
  - bash
  - curl または wget（セットアップで使用）
  - unzip（macOSでFFmpegを展開するのに使用）
  - tar（Linux・macOSでPythonを展開するのに使用）

## トラブルシューティング

### Windows

- **セットアップが失敗する場合**:
  - PowerShellが管理者として実行されていることを確認してください
  - PowerShellの実行ポリシーを一時的に変更してみてください：
    ```powershell
    Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
    ```
  - インターネット接続が安定していることを確認してください

- **バッチファイルで文字化けが発生する場合**:
  - アプリケーションは自動的にUTF-8コードページ（65001）を設定します
  - それでも問題が発生する場合は、コマンドプロンプトで手動で以下を実行してみてください：
    ```
    chcp 65001
    ```
  - その後、setup.batや2webm.batを実行してください

### Linux / macOS

- **「Permission denied」エラーが発生する場合**:
  - スクリプトに実行権限があることを確認してください：
    ```bash
    chmod +x setup.sh 2webm.sh
    ```

- **FFmpegのダウンロードに失敗する場合**:
  - 手動でFFmpegをダウンロードして、`ffmpeg/bin`ディレクトリに配置してください
  - Linux: https://johnvansickle.com/ffmpeg/
  - macOS: https://evermeet.cx/ffmpeg/

- **Pythonのダウンロードに失敗する場合**:
  - 手動でPython埋め込みパッケージをダウンロードして、`python`ディレクトリに展開してください
  - https://github.com/indygreg/python-build-standalone/releases/

## 手動セットアップ

自動セットアップが失敗する場合は、以下の手順で手動セットアップを行うことができます:

1. [Python Embedded Package](https://www.python.org/downloads/) から組み込みPythonをダウンロードし、`python` フォルダに展開します
2. [FFmpeg](https://ffmpeg.org/download.html) をダウンロードし、`ffmpeg/bin` ディレクトリに `ffmpeg.exe` を配置します

## 設定ファイル

アプリケーションの初回起動時に `config.json` ファイルが自動的に作成されます。このファイルをテキストエディタで編集することで、様々な設定をカスタマイズできます。

### 設定オプション

```json
{
    // 出力ディレクトリのパス
    "output_directory": "output",
    // 出力ファイル名のテンプレート
    "output_filename_template": "output-{timestamp}",
    // エンコード後に出力ディレクトリを開くか確認するか
    "show_output_dir_prompt": true,
    // エンコード後に次のファイル処理を確認するか
    "ask_for_next_file": false,
    // デフォルトの出力形式（1=MP4, 2=WebM）
    "default_format": "1",
    // デフォルトのサイズ（1=原寸大）
    "default_size": "1",
    // デフォルトのビットレート（1=自動）
    "default_bitrate": "1"
}
```

#### 設定項目の説明

- **output_directory**: 変換された動画ファイルの保存先ディレクトリ
  - 相対パスの場合はアプリケーションフォルダを基準にします
  - 絶対パスも指定可能です（例: `"C:\\Users\\Username\\Videos"`）

- **output_filename_template**: 出力ファイル名のテンプレート
  - `{timestamp}` はYYMMDD-HHMMSS形式の現在時刻に置換されます
  - 例: `"myVideo-{timestamp}"` ⇒ `"myVideo-230513-235012.mp4"`

- **show_output_dir_prompt**: エンコード完了後に出力ディレクトリを開くか確認するかどうか
  - `true`: 確認プロンプトを表示
  - `false`: 確認プロンプトを表示せず、自動的にスキップ

- **ask_for_next_file**: エンコード完了後に次のファイル処理に進むか確認するかどうか
  - `true`: 「別の動画を処理しますか？」と確認
  - `false`: 確認なしで自動的に次のファイル処理に進む

- **default_format**: デフォルトで選択される出力形式
  - `"1"`: MP4（H.264）
  - `"2"`: WebM（VP9）

- **default_size**: デフォルトで選択される出力サイズ
  - `"1"`: 原寸大
  - `"2"`: HD (1280p max)
  - `"3"`: SD (720p max)
  - `"4"`: Small (480p max)
  - `"5"`: Tiny (360p max)

- **default_bitrate**: デフォルトで選択されるビットレート
  - `"1"`: 自動（品質ベース）
  - `"2"`: 高品質（2Mbps）
  - `"3"`: 標準（1Mbps）
  - `"4"`: 低品質（500kbps）

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。